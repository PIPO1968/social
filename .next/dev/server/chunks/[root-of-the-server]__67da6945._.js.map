{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/app/api/trofeos/user-trofeos/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const nick = searchParams.get('nick');\r\n\r\n        if (!nick) {\r\n            return NextResponse.json({ error: 'Nick required' }, { status: 400 });\r\n        }\r\n\r\n        const user = await prisma.user.findUnique({ where: { nick } });\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'User not found' }, { status: 404 });\r\n        }\r\n\r\n        const userTrofeos = await prisma.userTrofeo.findMany({\r\n            where: { userId: user.id }\r\n        });\r\n\r\n        const trofeosDesbloqueados = userTrofeos.filter(t => t.desbloqueado).map(t => t.trofeoId);\r\n        const trofeosBloqueados = userTrofeos.filter(t => !t.desbloqueado).map(t => t.trofeoId);\r\n\r\n        console.log('API user-trofeos GET: Returning for', nick);\r\n        console.log('trofeosDesbloqueados:', trofeosDesbloqueados);\r\n        console.log('trofeosBloqueados:', trofeosBloqueados);\r\n\r\n        return NextResponse.json({ trofeosDesbloqueados, trofeosBloqueados });\r\n    } catch (error) {\r\n        console.error('Error fetching user trofeos:', error);\r\n        return NextResponse.json({ error: 'Error fetching user trofeos' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const body = await request.json();\r\n        const { nick, trofeosDesbloqueados, trofeosBloqueados } = body;\r\n\r\n        console.log('API user-trofeos POST: Received data for', nick);\r\n        console.log('trofeosDesbloqueados:', trofeosDesbloqueados);\r\n        console.log('trofeosBloqueados:', trofeosBloqueados);\r\n\r\n        const user = await prisma.user.findUnique({ where: { nick } });\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'User not found' }, { status: 404 });\r\n        }\r\n\r\n        // Delete existing\r\n        await prisma.userTrofeo.deleteMany({ where: { userId: user.id } });\r\n\r\n        // Create new\r\n        const trofeos: { userId: number; trofeoId: number; desbloqueado: boolean }[] = [];\r\n        trofeosDesbloqueados.forEach((id: number) => {\r\n            trofeos.push({ userId: user.id, trofeoId: id, desbloqueado: true });\r\n        });\r\n        trofeosBloqueados.forEach((id: number) => {\r\n            trofeos.push({ userId: user.id, trofeoId: id, desbloqueado: false });\r\n        });\r\n\r\n        console.log('API user-trofeos POST: Creating trofeos:', trofeos);\r\n\r\n        await prisma.userTrofeo.createMany({ data: trofeos });\r\n\r\n        console.log('API user-trofeos POST: Successfully saved trofeos for', nick);\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        console.error('Error updating user trofeos:', error);\r\n        return NextResponse.json({ error: 'Error updating user trofeos' }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;QAE9B,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAK;QAAE;QAC5D,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,cAAc,MAAM,OAAO,UAAU,CAAC,QAAQ,CAAC;YACjD,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;QAC7B;QAEA,MAAM,uBAAuB,YAAY,MAAM,CAAC,CAAA,IAAK,EAAE,YAAY,EAAE,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ;QACxF,MAAM,oBAAoB,YAAY,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,YAAY,EAAE,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ;QAEtF,QAAQ,GAAG,CAAC,uCAAuC;QACnD,QAAQ,GAAG,CAAC,yBAAyB;QACrC,QAAQ,GAAG,CAAC,sBAAsB;QAElC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAsB;QAAkB;IACvE,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACrF;AACJ;AAEO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,oBAAoB,EAAE,iBAAiB,EAAE,GAAG;QAE1D,QAAQ,GAAG,CAAC,4CAA4C;QACxD,QAAQ,GAAG,CAAC,yBAAyB;QACrC,QAAQ,GAAG,CAAC,sBAAsB;QAElC,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAK;QAAE;QAC5D,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,kBAAkB;QAClB,MAAM,OAAO,UAAU,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,QAAQ,KAAK,EAAE;YAAC;QAAE;QAEhE,aAAa;QACb,MAAM,UAAyE,EAAE;QACjF,qBAAqB,OAAO,CAAC,CAAC;YAC1B,QAAQ,IAAI,CAAC;gBAAE,QAAQ,KAAK,EAAE;gBAAE,UAAU;gBAAI,cAAc;YAAK;QACrE;QACA,kBAAkB,OAAO,CAAC,CAAC;YACvB,QAAQ,IAAI,CAAC;gBAAE,QAAQ,KAAK,EAAE;gBAAE,UAAU;gBAAI,cAAc;YAAM;QACtE;QAEA,QAAQ,GAAG,CAAC,4CAA4C;QAExD,MAAM,OAAO,UAAU,CAAC,UAAU,CAAC;YAAE,MAAM;QAAQ;QAEnD,QAAQ,GAAG,CAAC,yDAAyD;QAErE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACrF;AACJ","debugId":null}}]
}