{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/utils/jwt.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';\r\n\r\nexport function signToken(payload: any): string {\r\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\r\n}\r\n\r\nexport function verifyToken(token: string): any {\r\n    try {\r\n        return jwt.verify(token, JWT_SECRET);\r\n    } catch (error) {\r\n        return null;\r\n    }\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAY;IAClC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AAC3D;AAEO,SAAS,YAAY,KAAa;IACrC,IAAI;QACA,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ","debugId":null}},
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/app/api/auth/me/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { verifyToken } from '@/utils/jwt';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const token = request.cookies.get('auth-token')?.value;\r\n\r\n        if (!token) {\r\n            return NextResponse.json({ error: 'No autenticado' }, { status: 401 });\r\n        }\r\n\r\n        const decoded = verifyToken(token);\r\n        if (!decoded) {\r\n            return NextResponse.json({ error: 'Token inválido' }, { status: 401 });\r\n        }\r\n\r\n        const user = await prisma.user.findUnique({\r\n            where: { id: decoded.userId },\r\n            include: {\r\n                historias: {\r\n                    select: {\r\n                        id: true,\r\n                        likes: true\r\n                    }\r\n                },\r\n                amigosComoUser: {\r\n                    select: {\r\n                        id: true\r\n                    }\r\n                },\r\n                amigosComoAmigo: {\r\n                    select: {\r\n                        id: true\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Usuario no encontrado' }, { status: 404 });\r\n        }\r\n\r\n        // Calcular estadísticas adicionales\r\n        const totalLikesHistorias = user.historias.reduce((sum: number, historia: any) => sum + (historia.likes || 0), 0);\r\n        const totalAmigos = (user.amigosComoUser.length + user.amigosComoAmigo.length) / 2;\r\n\r\n        // Obtener likes de championship por separado\r\n        let totalLikesChampionship = 0;\r\n        try {\r\n            const championshipResults = await prisma.championshipResult.findMany({\r\n                where: { userId: decoded.userId },\r\n                select: { likes: true }\r\n            });\r\n            totalLikesChampionship = championshipResults.reduce((sum, result) => sum + (result.likes || 0), 0);\r\n        } catch (error) {\r\n            console.error('Error obteniendo likes de championship:', error);\r\n            // Si falla, usar 0\r\n        }\r\n\r\n        const likesConcursos = (user.concursosGanados || 0) * 10;\r\n        const likesManuales = user.likes || 0;\r\n        const totalLikes = totalLikesHistorias + totalLikesChampionship + likesConcursos + likesManuales;\r\n\r\n        // Devolver usuario sin contraseña, con estadísticas calculadas\r\n        const { password, historias, amigosComoUser, amigosComoAmigo, ...userWithoutPassword } = user;\r\n        const userWithStats = {\r\n            ...userWithoutPassword,\r\n            likes: totalLikes,\r\n            amigos: totalAmigos,\r\n            historias: user.historias.length\r\n        };\r\n\r\n        console.log(`User ${user.nick} respuestasAcertadas:`, user.respuestasAcertadas);\r\n\r\n        return NextResponse.json({ user: userWithStats });\r\n    } catch (error) {\r\n        console.error('Error obteniendo usuario actual:', error);\r\n        return NextResponse.json({ error: 'Error interno del servidor' }, { status: 500 });\r\n    } finally {\r\n        await prisma.$disconnect();\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;QAEjD,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,UAAU,IAAA,oIAAW,EAAC;QAC5B,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE,IAAI,QAAQ,MAAM;YAAC;YAC5B,SAAS;gBACL,WAAW;oBACP,QAAQ;wBACJ,IAAI;wBACJ,OAAO;oBACX;gBACJ;gBACA,gBAAgB;oBACZ,QAAQ;wBACJ,IAAI;oBACR;gBACJ;gBACA,iBAAiB;oBACb,QAAQ;wBACJ,IAAI;oBACR;gBACJ;YACJ;QACJ;QAEA,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,oCAAoC;QACpC,MAAM,sBAAsB,KAAK,SAAS,CAAC,MAAM,CAAC,CAAC,KAAa,WAAkB,MAAM,CAAC,SAAS,KAAK,IAAI,CAAC,GAAG;QAC/G,MAAM,cAAc,CAAC,KAAK,cAAc,CAAC,MAAM,GAAG,KAAK,eAAe,CAAC,MAAM,IAAI;QAEjF,6CAA6C;QAC7C,IAAI,yBAAyB;QAC7B,IAAI;YACA,MAAM,sBAAsB,MAAM,OAAO,kBAAkB,CAAC,QAAQ,CAAC;gBACjE,OAAO;oBAAE,QAAQ,QAAQ,MAAM;gBAAC;gBAChC,QAAQ;oBAAE,OAAO;gBAAK;YAC1B;YACA,yBAAyB,oBAAoB,MAAM,CAAC,CAAC,KAAK,SAAW,MAAM,CAAC,OAAO,KAAK,IAAI,CAAC,GAAG;QACpG,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,2CAA2C;QACzD,mBAAmB;QACvB;QAEA,MAAM,iBAAiB,CAAC,KAAK,gBAAgB,IAAI,CAAC,IAAI;QACtD,MAAM,gBAAgB,KAAK,KAAK,IAAI;QACpC,MAAM,aAAa,sBAAsB,yBAAyB,iBAAiB;QAEnF,+DAA+D;QAC/D,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,cAAc,EAAE,eAAe,EAAE,GAAG,qBAAqB,GAAG;QACzF,MAAM,gBAAgB;YAClB,GAAG,mBAAmB;YACtB,OAAO;YACP,QAAQ;YACR,WAAW,KAAK,SAAS,CAAC,MAAM;QACpC;QAEA,QAAQ,GAAG,CAAC,CAAC,KAAK,EAAE,KAAK,IAAI,CAAC,qBAAqB,CAAC,EAAE,KAAK,mBAAmB;QAE9E,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,MAAM;QAAc;IACnD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IACpF,SAAU;QACN,MAAM,OAAO,WAAW;IAC5B;AACJ","debugId":null}}]
}