{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/app/api/premium/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const { action, nick, solicitudId, motivo } = await request.json();\r\n\r\n        if (action === 'approve' || action === 'reject') {\r\n            if (!solicitudId) {\r\n                return NextResponse.json({ error: 'ID de solicitud requerido' }, { status: 400 });\r\n            }\r\n\r\n            const solicitud = await prisma.solicitudPremium.findUnique({\r\n                where: { id: solicitudId },\r\n                include: { user: true }\r\n            });\r\n\r\n            if (!solicitud) {\r\n                return NextResponse.json({ error: 'Solicitud no encontrada' }, { status: 404 });\r\n            }\r\n\r\n            if (action === 'approve') {\r\n                // Activar premium\r\n                await prisma.user.update({\r\n                    where: { id: solicitud.userId },\r\n                    data: { premium: true }\r\n                });\r\n\r\n                await prisma.solicitudPremium.update({\r\n                    where: { id: solicitudId },\r\n                    data: { estado: 'aprobado' }\r\n                });\r\n\r\n                return NextResponse.json({ message: `Premium aprobado para ${solicitud.user.nick}` });\r\n            } else {\r\n                await prisma.solicitudPremium.update({\r\n                    where: { id: solicitudId },\r\n                    data: { estado: 'rechazado' }\r\n                });\r\n\r\n                return NextResponse.json({ message: `Solicitud rechazada para ${solicitud.user.nick}` });\r\n            }\r\n        }\r\n\r\n        if (!nick) {\r\n            return NextResponse.json({ error: 'Nick requerido' }, { status: 400 });\r\n        }\r\n\r\n        const user = await prisma.user.findUnique({\r\n            where: { nick },\r\n            select: { id: true, nick: true }\r\n        });\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Usuario no encontrado' }, { status: 404 });\r\n        }\r\n\r\n        if (action === 'activate') {\r\n            // Activar premium por 1 año\r\n            const fechaExpiracion = new Date();\r\n            fechaExpiracion.setFullYear(fechaExpiracion.getFullYear() + 1);\r\n\r\n            const userUpdated = await prisma.user.update({\r\n                where: { nick },\r\n                data: { premium: true }\r\n            });\r\n\r\n            // Crear o actualizar registro en premium_data\r\n            await prisma.premiumData.upsert({\r\n                where: { userId: userUpdated.id },\r\n                update: {\r\n                    fechaInicio: new Date(),\r\n                    fechaExpiracion: fechaExpiracion,\r\n                    activo: true\r\n                },\r\n                create: {\r\n                    userId: userUpdated.id,\r\n                    fechaInicio: new Date(),\r\n                    fechaExpiracion: fechaExpiracion,\r\n                    activo: true\r\n                }\r\n            });\r\n\r\n            return NextResponse.json({\r\n                message: `Premium activado para ${nick} hasta ${fechaExpiracion.toISOString().split('T')[0]}`\r\n            });\r\n        } else if (action === 'deactivate') {\r\n            await prisma.user.update({\r\n                where: { nick },\r\n                data: { premium: false }\r\n            });\r\n\r\n            return NextResponse.json({ message: `Premium desactivado para ${nick}` });\r\n        } else if (action === 'check') {\r\n            const userData = await prisma.user.findUnique({\r\n                where: { nick },\r\n                select: { premium: true }\r\n            });\r\n\r\n            return NextResponse.json({\r\n                premium: userData?.premium || false\r\n            });\r\n        }\r\n\r\n        return NextResponse.json({ error: 'Acción no válida' }, { status: 400 });\r\n    } catch (error) {\r\n        console.error('Error en premium:', error);\r\n        return NextResponse.json({ error: 'Error interno del servidor' }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}