{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/app/api/centros/ranking/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\n// POST: Guardar ranking mensual de centros\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const { year, month, rankings } = await request.json();\r\n\r\n        if (!year || !month || !rankings || !Array.isArray(rankings)) {\r\n            return NextResponse.json({ error: 'Datos inv√°lidos' }, { status: 400 });\r\n        }\r\n\r\n        const season = `m${year}${month.toString().padStart(2, '0')}`;\r\n\r\n        // Eliminar rankings anteriores para este mes\r\n        await prisma.championshipResult.deleteMany({\r\n            where: {\r\n                season,\r\n                type: 'centros'\r\n            }\r\n        });\r\n\r\n        // Insertar nuevos rankings\r\n        const results = rankings.map((ranking: any, index: number) => ({\r\n            centro: ranking.nombre,\r\n            season,\r\n            type: 'centros',\r\n            ganados: ranking.puntajeTotal || 0,\r\n            preguntasAcertadas: ranking.respuestasCorrectas || 0,\r\n            likes: ranking.interaccionesSociales || 0,\r\n            // Otros campos pueden ser 0 o calculados\r\n        }));\r\n\r\n        await prisma.championshipResult.createMany({\r\n            data: results\r\n        });\r\n\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        console.error('Error guardando ranking:', error);\r\n        return NextResponse.json({ error: 'Error interno' }, { status: 500 });\r\n    }\r\n}\r\n\r\n// GET: Cargar ranking mensual de centros o meses disponibles\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const action = searchParams.get('action');\r\n\r\n        if (action === 'months') {\r\n            // Obtener meses disponibles\r\n            const results = await prisma.championshipResult.findMany({\r\n                where: {\r\n                    type: 'centros'\r\n                },\r\n                select: {\r\n                    season: true\r\n                },\r\n                distinct: ['season']\r\n            });\r\n\r\n            const months = results.map(r => r.season).sort();\r\n            return NextResponse.json(months);\r\n        }\r\n\r\n        const year = parseInt(searchParams.get('year') || '');\r\n        const month = parseInt(searchParams.get('month') || '');\r\n\r\n        if (!year || !month) {\r\n            return NextResponse.json({ error: 'A√±o y mes requeridos' }, { status: 400 });\r\n        }\r\n\r\n        const season = `m${year}${month.toString().padStart(2, '0')}`;\r\n\r\n        const results = await prisma.championshipResult.findMany({\r\n            where: {\r\n                season,\r\n                type: 'centros'\r\n            },\r\n            orderBy: {\r\n                ganados: 'desc'\r\n            }\r\n        });\r\n\r\n        // Convertir a formato CentroStats\r\n        const rankings = results.map((result, index) => ({\r\n            nombre: result.centro,\r\n            estudiantes: 0, // TODO: calcular\r\n            estudiantesActivos: 0,\r\n            respuestasCorrectas: result.preguntasAcertadas,\r\n            concursosGanados: 0,\r\n            historiasCreadas: 0,\r\n            interaccionesSociales: result.likes,\r\n            diasConsecutivos: 0,\r\n            puntajeTotal: result.ganados,\r\n            ranking: index + 1,\r\n            medalla: index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ'\r\n        }));\r\n\r\n        return NextResponse.json(rankings);\r\n    } catch (error) {\r\n        console.error('Error:', error);\r\n        return NextResponse.json({ error: 'Error interno' }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}