{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/utils/jwt.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';\r\n\r\nexport function signToken(payload: any): string {\r\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\r\n}\r\n\r\nexport function verifyToken(token: string): any {\r\n    try {\r\n        return jwt.verify(token, JWT_SECRET);\r\n    } catch (error) {\r\n        return null;\r\n    }\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAY;IAClC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AAC3D;AAEO,SAAS,YAAY,KAAa;IACrC,IAAI;QACA,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ","debugId":null}},
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/app/api/user/increment-stat/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { verifyToken } from '@/utils/jwt';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const token = request.cookies.get('auth-token')?.value;\r\n        if (!token) {\r\n            return NextResponse.json({ error: 'No autenticado' }, { status: 401 });\r\n        }\r\n\r\n        const decoded = verifyToken(token);\r\n        if (!decoded) {\r\n            return NextResponse.json({ error: 'Token inválido' }, { status: 401 });\r\n        }\r\n\r\n        const user = await prisma.user.findUnique({\r\n            where: { id: decoded.userId }\r\n        });\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: 'Usuario no encontrado' }, { status: 404 });\r\n        }\r\n\r\n        const { stat, amount } = await request.json();\r\n\r\n        if (!stat || typeof amount !== 'number') {\r\n            return NextResponse.json({ error: 'Faltan parámetros stat o amount' }, { status: 400 });\r\n        }\r\n\r\n        // Validar que stat sea un campo válido\r\n        const validStats = ['respuestasAcertadas', 'concursosGanados', 'historiasCreadas', 'likes', 'preguntasFalladas'];\r\n        if (!validStats.includes(stat)) {\r\n            return NextResponse.json({ error: 'Stat no válido' }, { status: 400 });\r\n        }\r\n\r\n        // Actualizar el usuario\r\n        const updatedUser = await prisma.user.update({\r\n            where: { id: user.id },\r\n            data: {\r\n                [stat]: {\r\n                    increment: amount\r\n                }\r\n            }\r\n        });\r\n\r\n        console.log(`Updated user ${user.nick} stat ${stat} by ${amount}, new value:`, (updatedUser as any)[stat]);\r\n\r\n        return NextResponse.json({ success: true, user: updatedUser });\r\n\r\n        return NextResponse.json({ success: true, user: updatedUser });\r\n    } catch (error) {\r\n        console.error('Error al actualizar estadísticas:', error);\r\n        return NextResponse.json({ error: 'Error interno del servidor' }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;QACjD,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,UAAU,IAAA,oIAAW,EAAC;QAC5B,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE,IAAI,QAAQ,MAAM;YAAC;QAChC;QAEA,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE3C,IAAI,CAAC,QAAQ,OAAO,WAAW,UAAU;YACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkC,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,uCAAuC;QACvC,MAAM,aAAa;YAAC;YAAuB;YAAoB;YAAoB;YAAS;SAAoB;QAChH,IAAI,CAAC,WAAW,QAAQ,CAAC,OAAO;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,wBAAwB;QACxB,MAAM,cAAc,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC;YACzC,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;YACrB,MAAM;gBACF,CAAC,KAAK,EAAE;oBACJ,WAAW;gBACf;YACJ;QACJ;QAEA,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,KAAK,IAAI,CAAC,MAAM,EAAE,KAAK,IAAI,EAAE,OAAO,YAAY,CAAC,EAAE,AAAC,WAAmB,CAAC,KAAK;QAEzG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAY;;;IAGhE,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACJ","debugId":null}}]
}