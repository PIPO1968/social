{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/utils/jwt.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key';\r\n\r\nexport function signToken(payload: any): string {\r\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' });\r\n}\r\n\r\nexport function verifyToken(token: string): any {\r\n    try {\r\n        return jwt.verify(token, JWT_SECRET);\r\n    } catch (error) {\r\n        return null;\r\n    }\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,UAAU,OAAY;IAClC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AAC3D;AAEO,SAAS,YAAY,KAAa;IACrC,IAAI;QACA,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ","debugId":null}},
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/social/src/app/api/premium/competiciones/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { verifyToken } from '@/utils/jwt';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const token = request.cookies.get('auth-token')?.value;\r\n        if (!token) {\r\n            return NextResponse.json({ error: 'No autenticado' }, { status: 401 });\r\n        }\r\n\r\n        const decoded = verifyToken(token);\r\n        if (!decoded) {\r\n            return NextResponse.json({ error: 'Token inv치lido' }, { status: 401 });\r\n        }\r\n\r\n        const competicionData = await prisma.competicionPremium?.findUnique?.({\r\n            where: { userId: decoded.userId }\r\n        });\r\n\r\n        return NextResponse.json(competicionData || { victorias: 0, participaciones: 0, puntuacionTotal: 0 });\r\n    } catch (error) {\r\n        console.error('Error obteniendo competiciones premium:', error);\r\n        return NextResponse.json({ error: 'Error interno del servidor' }, { status: 500 });\r\n    } finally {\r\n        await prisma.$disconnect();\r\n    }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const token = request.cookies.get('auth-token')?.value;\r\n        if (!token) {\r\n            return NextResponse.json({ error: 'No autenticado' }, { status: 401 });\r\n        }\r\n\r\n        const decoded = verifyToken(token);\r\n        if (!decoded) {\r\n            return NextResponse.json({ error: 'Token inv치lido' }, { status: 401 });\r\n        }\r\n\r\n        let { victorias, participaciones, puntuacionTotal } = await request.json();\r\n\r\n        // Obtener puntos de torneos premium y sumarlos\r\n        let puntosTorneos = 0;\r\n        try {\r\n            const torneoData = await prisma.torneoPremium?.findUnique?.({ where: { userId: decoded.userId } });\r\n            let torneos = [];\r\n            if (torneoData && torneoData.torneos) {\r\n                if (typeof torneoData.torneos === 'string') {\r\n                    torneos = JSON.parse(torneoData.torneos);\r\n                } else {\r\n                    torneos = torneoData.torneos;\r\n                }\r\n            }\r\n            // Para cada torneo, sumar solo el mejor resultado del usuario\r\n            torneos.forEach((torneo: any) => {\r\n                if (torneo.resultados && Array.isArray(torneo.resultados)) {\r\n                    // Filtrar resultados del usuario actual\r\n                    const normalizar = (str: string) => (str || '').toLowerCase().replace(/\\s+/g, '');\r\n                    const resultadosUsuario = torneo.resultados.filter((r: any) => r.nick && decoded.nick && normalizar(r.nick) === normalizar(decoded.nick));\r\n                    if (resultadosUsuario.length > 0) {\r\n                        // Tomar el mejor resultado (mayor puntuaci칩n)\r\n                        const mejor = resultadosUsuario.reduce((max: any, curr: any) => curr.puntuacion > max.puntuacion ? curr : max, resultadosUsuario[0]);\r\n                        puntosTorneos += mejor.puntuacion || 0;\r\n                    }\r\n                }\r\n            });\r\n        } catch { }\r\n        // Sumar los puntos de torneos premium a la puntuaci칩n total\r\n        puntuacionTotal = (puntuacionTotal || 0) + puntosTorneos;\r\n\r\n        const competicionData = await prisma.competicionPremium?.upsert?.({\r\n            where: { userId: decoded.userId },\r\n            update: {\r\n                victorias: victorias ?? undefined,\r\n                participaciones: participaciones ?? undefined,\r\n                puntuacionTotal: puntuacionTotal ?? undefined\r\n            },\r\n            create: {\r\n                userId: decoded.userId,\r\n                victorias: victorias ?? 0,\r\n                participaciones: participaciones ?? 0,\r\n                puntuacionTotal: puntuacionTotal ?? 0\r\n            }\r\n        });\r\n\r\n        return NextResponse.json(competicionData);\r\n    } catch (error) {\r\n        console.error('Error guardando competiciones premium:', error);\r\n        return NextResponse.json({ error: 'Error interno del servidor' }, { status: 500 });\r\n    } finally {\r\n        await prisma.$disconnect();\r\n    }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}