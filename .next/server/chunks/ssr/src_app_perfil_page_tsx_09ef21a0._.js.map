{"version":3,"sources":["turbopack:///[project]/src/app/perfil/page.tsx","turbopack:///[project]/src/data/trofeosPremiumImport.ts"],"sourcesContent":["\"use client\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { renderNick } from \"@/utils/renderNick\";\r\nimport { TROFEOS_PREMIUM } from \"@/data/trofeosPremiumImport\";\r\nimport { useTranslation } from \"@/utils/i18n\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { BUTTON_STYLES } from \"../../utils/styles\";\r\n\r\ninterface Usuario {\r\n    nick: string;\r\n    nombre: string;\r\n    email: string;\r\n    centro: string;\r\n    curso: string;\r\n    tipo: string;\r\n    fechaInscripcion: string;\r\n    likes: number;\r\n    amigos: string[];\r\n    respuestasAcertadas: number;\r\n    competicionesSuperadas: number;\r\n    concursosGanados: number;\r\n    comentariosRecibidos: number;\r\n    historiasCreadas: number;\r\n    anosEnStoryUp: number;\r\n    trofeos: any[];\r\n};\r\n\r\nconst PerfilUsuario: React.FC = () => {\r\n    const router = useRouter();\r\n    // Funci칩n para asignar trofeos al usuario si su centro gan칩 premios este mes\r\n    const asignarTrofeosUsuario = async (usuario: any) => {\r\n        if (typeof window === \"undefined\") return;\r\n\r\n        const fechaActual = new Date();\r\n        const year = fechaActual.getFullYear();\r\n        const month = fechaActual.getMonth() + 1;\r\n\r\n        try {\r\n            const response = await fetch(`/api/premios/mensuales?year=${year}&month=${month}`);\r\n            const premios = await response.json();\r\n            const premioCentro = premios.find((p: any) => p.centro === usuario.centro);\r\n\r\n            if (premioCentro) {\r\n                let idTrofeo = 0;\r\n                switch (premioCentro.posicion) {\r\n                    case 1: idTrofeo = 25; break; // Campe칩n Mensual\r\n                    case 2: idTrofeo = 26; break; // Subcampe칩n Mensual\r\n                    case 3: idTrofeo = 27; break; // Tercer Lugar Mensual\r\n                    default:\r\n                        if (premioCentro.posicion <= 10) {\r\n                            idTrofeo = 28; // Top 10 Mensual\r\n                        } else {\r\n                            idTrofeo = 29; // Participante Activo\r\n                        }\r\n                        break;\r\n                }\r\n\r\n                if (idTrofeo > 0 && !usuario.trofeosDesbloqueados.includes(idTrofeo)) {\r\n                    const updated = {\r\n                        trofeosDesbloqueados: [...usuario.trofeosDesbloqueados, idTrofeo],\r\n                        trofeosBloqueados: usuario.trofeosBloqueados\r\n                    };\r\n                    await fetch('/api/trofeos/user-trofeos', {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ nick: usuario.nick, ...updated })\r\n                    });\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error('Error asignando trofeos:', e);\r\n        }\r\n    };\r\n\r\n    const [user, setUser] = useState<any>(null);\r\n    const [bullyingActivo, setBullyingActivo] = useState(false);\r\n    const [usuarioBullying, setUsuarioBullying] = useState(\"\");\r\n    const [palabraProhibida, setPalabraProhibida] = useState(\"\");\r\n    const [concursoTitulo, setConcursoTitulo] = useState(\"\");\r\n    const [concursoTexto, setConcursoTexto] = useState(\"\");\r\n    const [fechaInicio, setFechaInicio] = useState(\"\");\r\n    const [fechaFin, setFechaFin] = useState(\"\");\r\n    const [usuarioGanador, setUsuarioGanador] = useState(\"\");\r\n    const [concursoId, setConcursoId] = useState(1);\r\n    const [nombreArchivo, setNombreArchivo] = useState(\"\");\r\n    const [usuarios, setUsuarios] = useState<any[]>([]);\r\n    const [selectedUser, setSelectedUser] = useState(\"\");\r\n    const [chatInput, setChatInput] = useState(\"\");\r\n    const [chatMessages, setChatMessages] = useState<{ from: string, to: string, text: string, fecha?: string }[]>([]);\r\n    const [mensajeRecibido, setMensajeRecibido] = useState(false);\r\n    const [noticiaTitulo, setNoticiaTitulo] = useState(\"\");\r\n    const [noticiaTexto, setNoticiaTexto] = useState(\"\");\r\n    const [noticiaImagen, setNoticiaImagen] = useState<string>(\"\");\r\n    // Estado para el trofeo seleccionado por el admin\r\n    const [trofeoSeleccionado, setTrofeoSeleccionado] = useState(\"\");\r\n    // Estados para gestionar concursos finalizados\r\n    const [concursoSeleccionado, setConcursoSeleccionado] = useState(\"\");\r\n    const [ganadorSeleccionado, setGanadorSeleccionado] = useState(\"\");\r\n    const [selectedUserData, setSelectedUserData] = useState<any>(null);\r\n    // Estados para datos de base de datos\r\n    const [premiumData, setPremiumData] = useState<any>(null);\r\n    const [userTrofeos, setUserTrofeos] = useState<{ trofeosDesbloqueados: number[]; trofeosBloqueados: number[] }>({ trofeosDesbloqueados: [], trofeosBloqueados: [] });\r\n    const [concursos, setConcursos] = useState<any[]>([]);\r\n    // Estados para preguntas\r\n    const [cursoSeleccionado, setCursoSeleccionado] = useState<string>(\"1primaria\");\r\n    const [asignaturaSeleccionada, setAsignaturaSeleccionada] = useState<string>(\"matematicas\");\r\n    const [pregunta, setPregunta] = useState<string>(\"\");\r\n    const [respuesta, setRespuesta] = useState<string>(\"\");\r\n\r\n    const { t } = useTranslation();\r\n\r\n    // Inicializaci칩n y sincronizaci칩n de usuario y rankings SOLO una vez\r\n    useEffect(() => {\r\n        // Obtener usuario actual\r\n        fetch('/api/auth/me')\r\n            .then(response => {\r\n                if (!response.ok) {\r\n                    // Si la respuesta es 401 o similar, redirigir\r\n                    router.push('/');\r\n                    return null;\r\n                }\r\n                return response.json();\r\n            })\r\n            .then(data => {\r\n                if (data && data.user) {\r\n                    setUser(data.user);\r\n                } else if (data && !data.user) {\r\n                    // Solo redirigir si expl칤citamente no hay usuario\r\n                    router.push('/');\r\n                }\r\n            })\r\n            .catch(error => {\r\n                // Solo mostrar error, no redirigir autom치ticamente\r\n                console.warn('Error comprobando sesi칩n:', error);\r\n            });\r\n\r\n        // Obtener concursos\r\n        fetch('/api/concursos')\r\n            .then(response => response.json())\r\n            .then(concursos => {\r\n                setConcursos(concursos);\r\n            })\r\n            .catch(error => {\r\n                console.warn('No se pudo cargar la lista de concursos:', error);\r\n            });\r\n    }, []);\r\n\r\n    // Cargar mensajes del chat solo cuando cambia el usuario\r\n    useEffect(() => {\r\n        if (user && user.nick) {\r\n            fetch('/api/chat?nick=' + user.nick)\r\n                .then(response => response.json())\r\n                .then(messages => {\r\n                    setChatMessages(messages);\r\n                })\r\n                .catch(error => {\r\n                    console.warn('No se pudo cargar los mensajes del chat:', error);\r\n                });\r\n        }\r\n    }, [user]);\r\n\r\n\r\n    const displayedUser = selectedUser ? (selectedUserData || { ...user, trofeosDesbloqueados: userTrofeos.trofeosDesbloqueados, trofeosBloqueados: userTrofeos.trofeosBloqueados }) : { ...user, trofeosDesbloqueados: userTrofeos.trofeosDesbloqueados, trofeosBloqueados: userTrofeos.trofeosBloqueados };\r\n\r\n    // Cargar datos premium y trofeos del usuario mostrado\r\n    useEffect(() => {\r\n        if (displayedUser && displayedUser.nick) {\r\n            fetch('/api/premium/data?nick=' + displayedUser.nick)\r\n                .then(response => response.json())\r\n                .then(data => setPremiumData(data))\r\n                .catch(error => console.warn('No se pudo cargar datos premium:', error));\r\n\r\n            fetch('/api/trofeos/user-trofeos?nick=' + displayedUser.nick)\r\n                .then(response => response.json())\r\n                .then(data => setUserTrofeos(data))\r\n                .catch(error => console.warn('No se pudo cargar trofeos:', error));\r\n        }\r\n    }, [displayedUser]);\r\n\r\n    const handlePalabraProhibidaSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setPalabraProhibida(\"\");\r\n    };\r\n    const handleApagarBullying = () => {\r\n        setBullyingActivo(false);\r\n        setUsuarioBullying(\"\");\r\n    };\r\n    const handleConcursoSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        fetch('/api/concursos', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                numero: concursoId,\r\n                titulo: concursoTitulo,\r\n                texto: concursoTexto,\r\n                inicio: fechaInicio,\r\n                fin: fechaFin,\r\n                autor: user ? user.nick : \"\",\r\n                ganador: usuarioGanador,\r\n                fechaFinal: fechaFin\r\n            })\r\n        })\r\n            .then(response => response.json())\r\n            .then(() => {\r\n                setConcursoId(concursoId + 1);\r\n                setConcursoTitulo(\"\");\r\n                setConcursoTexto(\"\");\r\n                setFechaInicio(\"\");\r\n                setFechaFin(\"\");\r\n                setUsuarioGanador(\"\");\r\n                // Refrescar concursos\r\n                fetch('/api/concursos').then(r => r.json()).then(setConcursos);\r\n            })\r\n            .catch(error => {\r\n                console.error('Error creando concurso:', error);\r\n            });\r\n    };\r\n    // Funci칩n general para sumar o restar likes a cualquier usuario\r\n    const updateLikes = (nick: string, cantidad: number) => {\r\n        if (!nick) return;\r\n        const currentLikes = usuarios.find((u: any) => u.nick === nick)?.likes || 0;\r\n        fetch('/api/users/update', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ nick, likes: currentLikes + cantidad })\r\n        })\r\n            .then(response => response.json())\r\n            .then(updatedUser => {\r\n                const updatedUsers = usuarios.map((u: any) => u.nick === nick ? updatedUser : u);\r\n                setUsuarios(updatedUsers);\r\n                if (user && user.nick === nick) {\r\n                    setUser(updatedUser);\r\n                }\r\n            })\r\n            .catch(error => console.error('Error updating likes:', error));\r\n    };\r\n\r\n    const handleSeleccionarGanador = () => {\r\n        if (usuarioGanador) {\r\n            fetch('/api/concursos', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ id: concursos[0].id, ganador: usuarioGanador })\r\n            })\r\n                .then(() => {\r\n                    updateLikes(usuarioGanador, 1);\r\n                })\r\n                .catch(error => {\r\n                    console.error('Error seleccionando ganador:', error);\r\n                });\r\n        }\r\n    };\r\n    const handleAsignarGanador = async () => {\r\n        if (!concursoSeleccionado || !ganadorSeleccionado) {\r\n            return;\r\n        }\r\n        try {\r\n            await fetch('/api/concursos', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ id: concursoSeleccionado, ganador: ganadorSeleccionado })\r\n            });\r\n            updateLikes(ganadorSeleccionado, 10);\r\n            setConcursoSeleccionado(\"\");\r\n            setGanadorSeleccionado(\"\");\r\n            // Refrescar concursos\r\n            fetch('/api/concursos').then(r => r.json()).then(setConcursos);\r\n        } catch (error) {\r\n            console.error('Error asignando ganador:', error);\r\n        }\r\n    };\r\n    const handleNoticiaSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        fetch('/api/noticias', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                titulo: noticiaTitulo,\r\n                contenido: noticiaTexto,\r\n                autorNick: user ? user.nick : \"\"\r\n            })\r\n        })\r\n            .then(response => response.json())\r\n            .then(() => {\r\n                setNoticiaTitulo(\"\");\r\n                setNoticiaTexto(\"\");\r\n                setNoticiaImagen(\"\");\r\n            })\r\n            .catch(error => {\r\n                console.error('Error creando noticia:', error);\r\n            });\r\n    };\r\n\r\n    // Funci칩n para enviar pregunta\r\n    const enviarPregunta = async () => {\r\n        if (!pregunta.trim() || !respuesta.trim()) {\r\n            return;\r\n        }\r\n        try {\r\n            const response = await fetch('/api/add-question', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({\r\n                    curso: cursoSeleccionado,\r\n                    asignatura: asignaturaSeleccionada,\r\n                    pregunta: pregunta.trim(),\r\n                    respuesta: respuesta.trim(),\r\n                }),\r\n            });\r\n            const data = await response.json();\r\n            if (response.ok) {\r\n                setPregunta(\"\");\r\n                setRespuesta(\"\");\r\n            }\r\n        } catch (error) {\r\n            console.error('Error al enviar pregunta:', error);\r\n        }\r\n        // Funci칩n general para sumar o restar likes a cualquier usuario\r\n        const updateLikes = (nick: string, cantidad: number) => {\r\n            if (!nick) return;\r\n            const currentLikes = usuarios.find((u: any) => u.nick === nick)?.likes || 0;\r\n            fetch('/api/users/update', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ nick, likes: currentLikes + cantidad })\r\n            })\r\n                .then(response => response.json())\r\n                .then(updatedUser => {\r\n                    const updatedUsers = usuarios.map((u: any) => u.nick === nick ? updatedUser : u);\r\n                    setUsuarios(updatedUsers);\r\n                    if (user && user.nick === nick) {\r\n                        setUser(updatedUser);\r\n                    }\r\n                })\r\n                .catch(error => console.error('Error updating likes:', error));\r\n        };\r\n    };\r\n    // Funci칩n para bloquear trofeo espec칤fico\r\n    const handleLockTrofeo = (trofeoIdx: number) => {\r\n        if (!selectedUser) return;\r\n        const updated = {\r\n            trofeosDesbloqueados: Array.isArray(userTrofeos.trofeosDesbloqueados) ? userTrofeos.trofeosDesbloqueados.filter((id: number) => id !== trofeoIdx) : [],\r\n            trofeosBloqueados: Array.isArray(userTrofeos.trofeosBloqueados) ? [...userTrofeos.trofeosBloqueados, trofeoIdx] : [trofeoIdx]\r\n        };\r\n        fetch('/api/trofeos/user-trofeos', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ nick: selectedUser, ...updated })\r\n        })\r\n            .then(() => {\r\n                setUserTrofeos(updated);\r\n            })\r\n            .catch(error => {\r\n                console.error('Error locking trofeo:', error);\r\n            });\r\n    };    // Lista de trofeos normales (24)\r\n    const TROFEOS = [\r\n        { src: \"/trofeo1.jpg\", texto: \"Trofeo 1\", tipo: \"auto\" },\r\n        { src: \"/trofeo2.jpg\", texto: \"Trofeo 2\", tipo: \"auto\" },\r\n        { src: \"/trofeo3.jpg\", texto: \"Trofeo 3\", tipo: \"auto\" },\r\n        { src: \"/trofeo4.jpg\", texto: \"Trofeo 4\", tipo: \"auto\" },\r\n        { src: \"/trofeo5.jpg\", texto: \"Trofeo 5\", tipo: \"auto\" },\r\n        { src: \"/trofeo6.jpg\", texto: \"Trofeo 6\", tipo: \"auto\" },\r\n        { src: \"/trofeo7.jpg\", texto: \"Trofeo 7\", tipo: \"auto\" },\r\n        { src: \"/trofeo8.jpg\", texto: \"Trofeo 8\", tipo: \"auto\" },\r\n        { src: \"/trofeo9.jpg\", texto: \"Trofeo 9\", tipo: \"auto\" },\r\n        { src: \"/trofeo10.jpg\", texto: \"Trofeo 10\", tipo: \"auto\" },\r\n        { src: \"/trofeo11.jpg\", texto: \"Trofeo 11\", tipo: \"auto\" },\r\n        { src: \"/trofeo12.jpg\", texto: \"Trofeo 12\", tipo: \"auto\" },\r\n        { src: \"/trofeo13.png\", texto: \"Trofeo 13\", tipo: \"auto\" },\r\n        { src: \"/trofeo14.jpg\", texto: \"Trofeo 14\", tipo: \"auto\" },\r\n        { src: \"/trofeo15.jpg\", texto: \"Trofeo 15\", tipo: \"auto\" },\r\n        { src: \"/trofeo16.jpg\", texto: \"Trofeo 16\", tipo: \"auto\" },\r\n        { src: \"/trofeo17.jpg\", texto: \"Trofeo 17\", tipo: \"auto\" },\r\n        { src: \"/trofeo18.jpg\", texto: \"Trofeo 18\", tipo: \"auto\" },\r\n        { src: \"/trofeo19.jpg\", texto: \"Trofeo 19\", tipo: \"auto\" },\r\n        { src: \"/trofeo20.jpg\", texto: \"Trofeo 20\", tipo: \"auto\" },\r\n        { src: \"/trofeo21.jpg\", texto: \"Trofeo 21\", tipo: \"auto\" },\r\n        { src: \"/trofeo22.jpg\", texto: \"Trofeo 22\", tipo: \"auto\" },\r\n        { src: \"/trofeo23.jpg\", texto: \"Trofeo 23\", tipo: \"auto\" },\r\n        { src: \"/trofeo24.jpg\", texto: \"Trofeo 24\", tipo: \"auto\" },\r\n        { src: \"/trofeo1.jpg\", texto: \"游끥 Campe칩n Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo2.jpg\", texto: \"游볟 Subcampe칩n Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo3.jpg\", texto: \"游볠 Tercer Lugar Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo4.jpg\", texto: \"游끤 Top 10 Mensual\", tipo: \"asignado\" },\r\n        { src: \"/trofeo5.jpg\", texto: \"游닄 Participante Activo\", tipo: \"asignado\" }\r\n    ];\r\n    // Lista de trofeos premium (12)\r\n    // TROFEOS_PREMIUM ahora se importa desde trofeosPremiumImport.ts\r\n    // Trofeos autom치ticos con condici칩n\r\n    const TROFEOS_AUTO = [\r\n        { src: \"/trofeo1.jpg\", texto: \"Trofeo 1\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 10 },\r\n        { src: \"/trofeo2.jpg\", texto: \"Trofeo 2\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 1 },\r\n        { src: \"/trofeo3.jpg\", texto: \"Trofeo 3\", tipo: \"auto\", condicion: (user: any) => (user.comentariosRealizados || 0) >= 1 },\r\n        { src: \"/trofeo4.jpg\", texto: \"Trofeo 4\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 1 },\r\n        { src: \"/trofeo5.jpg\", texto: \"Trofeo 5\", tipo: \"auto\", condicion: (user: any) => (user.preguntasAcertadas || 0) >= 20 },\r\n        { src: \"/trofeo6.jpg\", texto: \"Trofeo 6\", tipo: \"auto\", condicion: (user: any) => (user.competicionesSuperadas || 0) >= 1 },\r\n        { src: \"/trofeo7.jpg\", texto: \"Trofeo 7\", tipo: \"auto\", condicion: (user: any) => !!user.estaEnRanking },\r\n        { src: \"/trofeo8.jpg\", texto: \"Trofeo 8\", tipo: \"auto\", condicion: (user: any) => (user.concursosGanados || 0) >= 1 },\r\n        { src: \"/trofeo9.jpg\", texto: \"Trofeo 9\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 100 },\r\n        { src: \"/trofeo10.jpg\", texto: \"Trofeo 10\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 10 },\r\n        { src: \"/trofeo11.jpg\", texto: \"Trofeo 11\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 3 },\r\n        { src: \"/trofeo12.jpg\", texto: \"Trofeo 12\", tipo: \"auto\", condicion: (user: any) => (user.comentariosRecibidos || 0) >= 3 },\r\n        { src: \"/trofeo13.png\", texto: \"Trofeo 13\", tipo: \"auto\", condicion: (user: any) => !!user.estaEnRankingCompeticiones },\r\n        { src: \"/trofeo14.jpg\", texto: \"Trofeo 14\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 500 },\r\n        { src: \"/trofeo15.jpg\", texto: \"Trofeo 15\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 30 },\r\n        { src: \"/trofeo16.jpg\", texto: \"Trofeo 16\", tipo: \"auto\", condicion: (user: any) => (user.comentariosRecibidos || 0) >= 10 },\r\n        { src: \"/trofeo17.jpg\", texto: \"Trofeo 17\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 15 },\r\n        { src: \"/trofeo18.jpg\", texto: \"Trofeo 18\", tipo: \"auto\", condicion: (user: any) => (user.concursosGanados || 0) >= 3 },\r\n        { src: \"/trofeo19.jpg\", texto: \"Trofeo 19\", tipo: \"auto\", condicion: (user: any) => (user.preguntasAcertadas || 0) >= 1000 },\r\n        {\r\n            src: \"/trofeo20.jpg\", texto: \"Trofeo 20\", tipo: \"auto\", condicion: (user: any) => {\r\n                if (!user.fechaInscripcion) return false;\r\n                const fecha = new Date(user.fechaInscripcion);\r\n                const ahora = new Date();\r\n                const diff = ahora.getTime() - fecha.getTime();\r\n                return diff >= 365 * 24 * 60 * 60 * 1000; // 1 a침o en ms\r\n            }\r\n        },\r\n        { src: \"/trofeo21.jpg\", texto: \"Trofeo 21\", tipo: \"auto\", condicion: (user: any) => (user.historias?.length || 0) >= 30 },\r\n        { src: \"/trofeo22.jpg\", texto: \"Trofeo 22\", tipo: \"auto\", condicion: (user: any) => (user.likes || 0) >= 1000 },\r\n        { src: \"/trofeo23.jpg\", texto: \"Trofeo 23\", tipo: \"auto\", condicion: (user: any) => (user.amigos?.length || 0) >= 50 }\r\n    ];\r\n    // Unificar todos los trofeos para el selector\r\n    const TROFEOS_ALL = [...TROFEOS, ...TROFEOS_PREMIUM];\r\n    // Funci칩n para obtener trofeos desbloqueados autom치ticamente\r\n    const getAutoTrofeos = (user: any) => {\r\n        // Trofeo Premium 7: Dise침ador del Futuro\r\n        // ...existing code...\r\n        // Asegurar que el campo amigos es siempre un array actualizado\r\n        const userSync = {\r\n            ...user,\r\n            amigos: Array.isArray(user.amigos) ? user.amigos : []\r\n        };\r\n        let autoTrofeos = TROFEOS_AUTO\r\n            .map((t, idx) => (typeof t.condicion === 'function' && t.condicion(userSync)) ? idx : null)\r\n            .filter(idx => idx !== null);\r\n\r\n        // Desbloqueo autom치tico de trofeos premium\r\n        const esPremium = userSync.premium === true || userSync.isPremium === true || userSync.tipo === \"premium\";\r\n        const historiasCreadas = Array.isArray(userSync.historias) ? userSync.historias.length : (userSync.historiasCreadas || 0);\r\n        const preguntasAcertadas = userSync.preguntasAcertadas || 0;\r\n        // Trofeo Premium 1: Historiador Premium\r\n        if (esPremium && historiasCreadas >= 35) {\r\n            autoTrofeos.push(TROFEOS.length); // 칈ndice del trofeo premium 1\r\n        }\r\n        // Trofeo Premium 2: Sabio Premium\r\n        if (esPremium && preguntasAcertadas >= 1200) {\r\n            autoTrofeos.push(TROFEOS.length + 1); // 칈ndice del trofeo premium 2\r\n        }\r\n        // Trofeo Premium 3: Amigo Premium\r\n        const amigosCount = Array.isArray(userSync.amigos) ? userSync.amigos.length : 0;\r\n        if (esPremium && amigosCount >= 60) {\r\n            autoTrofeos.push(TROFEOS.length + 2); // 칈ndice del trofeo premium 3\r\n        }\r\n        // Trofeo Premium 4: Esp칤ritu Navide침o Premium\r\n        let tieneHistoriaNavidad = false;\r\n        if (esPremium && Array.isArray(userSync.historias)) {\r\n            tieneHistoriaNavidad = userSync.historias.some((historia: any) => {\r\n                if (!historia || !historia.titulo || !historia.fecha || !historia.modo) return false;\r\n                const tituloLower = historia.titulo.toLowerCase();\r\n                const esNavidad = tituloLower.includes(\"navidad\") || tituloLower.includes(\"navide침o\") || tituloLower.includes(\"navide침a\");\r\n                const fecha = new Date(historia.fecha);\r\n                const year = fecha.getFullYear();\r\n                // Rango: 20 diciembre a 6 enero (del a침o siguiente)\r\n                const inicio = new Date(year, 11, 20); // 20 diciembre\r\n                const fin = new Date(year + 1, 0, 6, 23, 59, 59); // 6 enero\r\n                return historia.modo === \"My Live\" && esNavidad && fecha >= inicio && fecha <= fin;\r\n            });\r\n        }\r\n        if (esPremium && tieneHistoriaNavidad) {\r\n            autoTrofeos.push(TROFEOS.length + 3); // 칈ndice del trofeo premium 4\r\n        }\r\n        // Trofeo Premium 5: Verano Dorado Premium\r\n        let tieneHistoriaVerano = false;\r\n        if (esPremium && Array.isArray(userSync.historias)) {\r\n            tieneHistoriaVerano = userSync.historias.some((historia: any) => {\r\n                if (!historia || !historia.fecha || !historia.modo) return false;\r\n                const fecha = new Date(historia.fecha);\r\n                // Rango: 15 junio a 15 septiembre\r\n                const year = fecha.getFullYear();\r\n                const inicio = new Date(year, 5, 15); // 15 junio\r\n                const fin = new Date(year, 8, 15, 23, 59, 59); // 15 septiembre\r\n                return historia.modo === \"My Live\" && fecha >= inicio && fecha <= fin;\r\n            });\r\n        }\r\n        if (esPremium && tieneHistoriaVerano) {\r\n            autoTrofeos.push(TROFEOS.length + 4); // 칈ndice del trofeo premium 5\r\n        }\r\n        // Trofeo Premium 6: Veterano Dorado\r\n        let mesesPremium = 0;\r\n        if (userSync.premiumInicio && userSync.premiumExpiracion) {\r\n            const inicio = new Date(userSync.premiumInicio);\r\n            const fin = new Date(userSync.premiumExpiracion);\r\n            // Calcular meses completos entre inicio y fin\r\n            mesesPremium = (fin.getFullYear() - inicio.getFullYear()) * 12 + (fin.getMonth() - inicio.getMonth());\r\n            // Si el d칤a de expiraci칩n es menor que el de inicio, restar un mes\r\n            if (fin.getDate() < inicio.getDate()) {\r\n                mesesPremium--;\r\n            }\r\n        }\r\n        if (esPremium && mesesPremium >= 6) {\r\n            autoTrofeos.push(TROFEOS.length + 5); // 칈ndice del trofeo premium 6\r\n        }\r\n        // Trofeo Premium 7: Dise침ador del Futuro\r\n        let tieneLogoStoryUp = false;\r\n        if (esPremium && Array.isArray(userSync.historias)) {\r\n            tieneLogoStoryUp = userSync.historias.some((historia: any) => {\r\n                if (!historia || !historia.titulo || !historia.imagen) return false;\r\n                const tituloLower = historia.titulo.toLowerCase();\r\n                return tituloLower.includes(\"logo storyup\") && !!historia.imagen;\r\n            });\r\n        }\r\n        if (esPremium && tieneLogoStoryUp) {\r\n            autoTrofeos.push(TROFEOS.length + 6); // 칈ndice del trofeo premium 7\r\n        }\r\n        // Trofeo Premium 8: Escritor Premium\r\n        if (esPremium && historiasCreadas >= 15) {\r\n            autoTrofeos.push(TROFEOS.length + 7); // 칈ndice del trofeo premium 8\r\n        }\r\n\r\n        // Trofeo Premium 9: Competidor Premium\r\n        // Consigue al menos 30 trofeos (normales + premium)\r\n        const totalTrofeosDesbloqueados = Array.isArray(userSync.trofeosDesbloqueados) ? userSync.trofeosDesbloqueados.length : 0;\r\n        // Incluye los autom치ticos calculados en esta funci칩n\r\n        const totalAutoTrofeos = autoTrofeos.length;\r\n        const totalTrofeos = totalTrofeosDesbloqueados + totalAutoTrofeos;\r\n        if (esPremium && totalTrofeos >= 30) {\r\n            autoTrofeos.push(TROFEOS.length + 8); // 칈ndice del trofeo premium 9\r\n        }\r\n        // Trofeo Premium 10: Cerebro de Oro\r\n        // 2500+ preguntas acertadas en Aprende con Pipo\r\n        if (esPremium && preguntasAcertadas >= 2500) {\r\n            autoTrofeos.push(TROFEOS.length + 9); // 칈ndice del trofeo premium 10\r\n        }\r\n\r\n        // Trofeo Premium 11: Analista Premium\r\n        // Consigue nivel 3 en todas las materias en \"Analisis por materias\" de Estad칤sticas premium Avanzadas\r\n        // Suponemos que user.nivelesMaterias es un objeto tipo { matematicas: 3, lenguaje: 3, ... }\r\n        const materiasRequeridas = [\"matematicas\", \"lenguaje\", \"ciencias\", \"ingles\", \"historia\", \"geografia\", \"literatura\"];\r\n        const nivelesMaterias = userSync.nivelesMaterias || {};\r\n        const todasNivel3 = materiasRequeridas.every(m => nivelesMaterias[m] >= 3);\r\n        if (esPremium && todasNivel3) {\r\n            autoTrofeos.push(TROFEOS.length + 10); // 칈ndice del trofeo premium 11\r\n        }\r\n        // Trofeo Premium 12: Red Social Premium\r\n        // Conseguir 100+ amigos\r\n        if (esPremium && amigosCount >= 100) {\r\n            autoTrofeos.push(TROFEOS.length + 11); // 칈ndice del trofeo premium 12\r\n        }\r\n        return autoTrofeos;\r\n    };\r\n    // Funci칩n para saber si un trofeo est치 desbloqueado\r\n    const isTrofeoUnlocked = (user: any, idx: number) => {\r\n        const auto = getAutoTrofeos(user);\r\n        const manual = Array.isArray(user.trofeosDesbloqueados) ? user.trofeosDesbloqueados : [];\r\n        const bloqueados = Array.isArray(user.trofeosBloqueados) ? user.trofeosBloqueados : [];\r\n        const asignados = Array.isArray(user.trofeos) ? user.trofeos : [];\r\n        return (auto.includes(idx) || manual.includes(idx) || asignados.includes(idx)) && !bloqueados.includes(idx);\r\n    };\r\n\r\n    if (!user) {\r\n        return (\r\n            <div className=\"min-h-screen bg-green-100 flex items-center justify-center\">\r\n                <div className=\"max-w-md w-full bg-white shadow rounded p-6 text-center\">\r\n                    <h2 className=\"text-2xl font-bold mb-4\">Perfil</h2>\r\n                    <p className=\"text-gray-600\">No se ha iniciado sesi칩n.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const isPremium = displayedUser ? (premiumData && premiumData.activo) : false;\r\n    return (\r\n        <div className=\"min-h-screen bg-green-100 flex flex-col pt-4\">\r\n            {/* ...existing code... */}\r\n            {/* BLOQUES EXTRA SOLO PARA DOCENTES */}\r\n            {user.tipo && user.tipo.toLowerCase() === \"docente\" && (\r\n                <div className=\"w-full max-w-6xl mx-auto mt-16 grid grid-cols-2 gap-12\">\r\n                    {/* Bloque: Crear noticia */}\r\n                    <form onSubmit={handleNoticiaSubmit} className=\"bg-white shadow rounded p-6 mb-8 flex flex-col gap-4\">\r\n                        <h3 className=\"text-lg font-bold mb-2\">Crear noticia</h3>\r\n                        <input type=\"text\" value={noticiaTitulo} onChange={e => setNoticiaTitulo(e.target.value)} placeholder=\"T칤tulo\" className=\"border p-2 rounded\" />\r\n                        <textarea value={noticiaTexto} onChange={e => setNoticiaTexto(e.target.value)} placeholder=\"Contenido\" className=\"border p-2 rounded\" />\r\n                        <button type=\"submit\" className=\"bg-blue-500 text-white px-4 py-2 rounded\">Publicar noticia</button>\r\n                    </form>\r\n\r\n                    {/* Bloque: Crear concurso */}\r\n                    <form onSubmit={handleConcursoSubmit} className=\"bg-white shadow rounded p-6 mb-8 flex flex-col gap-4\">\r\n                        <h3 className=\"text-lg font-bold mb-2\">Crear concurso</h3>\r\n                        <input type=\"text\" value={concursoTitulo} onChange={e => setConcursoTitulo(e.target.value)} placeholder=\"T칤tulo\" className=\"border p-2 rounded\" />\r\n                        <textarea value={concursoTexto} onChange={e => setConcursoTexto(e.target.value)} placeholder=\"Descripci칩n\" className=\"border p-2 rounded\" />\r\n                        <input type=\"date\" value={fechaInicio} onChange={e => setFechaInicio(e.target.value)} className=\"border p-2 rounded\" />\r\n                        <input type=\"date\" value={fechaFin} onChange={e => setFechaFin(e.target.value)} className=\"border p-2 rounded\" />\r\n                        <button type=\"submit\" className=\"bg-green-500 text-white px-4 py-2 rounded\">Crear concurso</button>\r\n                    </form>\r\n\r\n                    {/* Gesti칩n de Concursos Finalizados */}\r\n                    <div className=\"bg-white shadow rounded p-6 mb-8 flex flex-col gap-4\">\r\n                        <h3 className=\"text-lg font-bold mb-2\">Gesti칩n de concursos finalizados</h3>\r\n                        <select value={concursoSeleccionado} onChange={e => setConcursoSeleccionado(e.target.value)} className=\"border p-2 rounded\">\r\n                            <option value=\"\">Selecciona concurso</option>\r\n                            {concursos.map(c => (\r\n                                <option key={c.id} value={c.id}>{c.titulo}</option>\r\n                            ))}\r\n                        </select>\r\n                        <input type=\"text\" value={ganadorSeleccionado} onChange={e => setGanadorSeleccionado(e.target.value)} placeholder=\"Nick del ganador\" className=\"border p-2 rounded\" />\r\n                        <button type=\"button\" onClick={handleAsignarGanador} className=\"bg-yellow-500 text-white px-4 py-2 rounded\">Asignar ganador</button>\r\n                    </div>\r\n\r\n                    {/* Bloque: Agregar Pregunta - Aprende con Pipo */}\r\n                    <form onSubmit={e => { e.preventDefault(); enviarPregunta(); }} className=\"bg-white shadow rounded p-6 mb-8 flex flex-col gap-4\">\r\n                        <h3 className=\"text-lg font-bold mb-2\">Agregar pregunta (Aprende con Pipo)</h3>\r\n                        <select value={cursoSeleccionado} onChange={e => setCursoSeleccionado(e.target.value)} className=\"border p-2 rounded\">\r\n                            <option value=\"1primaria\">1췈 Primaria</option>\r\n                            <option value=\"2primaria\">2췈 Primaria</option>\r\n                            <option value=\"3primaria\">3췈 Primaria</option>\r\n                            <option value=\"4primaria\">4췈 Primaria</option>\r\n                            <option value=\"5primaria\">5췈 Primaria</option>\r\n                            <option value=\"6primaria\">6췈 Primaria</option>\r\n                        </select>\r\n                        <select value={asignaturaSeleccionada} onChange={e => setAsignaturaSeleccionada(e.target.value)} className=\"border p-2 rounded\">\r\n                            <option value=\"matematicas\">Matem치ticas</option>\r\n                            <option value=\"lenguaje\">Lenguaje</option>\r\n                            <option value=\"ciencias\">Ciencias</option>\r\n                            <option value=\"ingles\">Ingl칠s</option>\r\n                            <option value=\"historia\">Historia</option>\r\n                            <option value=\"geografia\">Geograf칤a</option>\r\n                            <option value=\"literatura\">Literatura</option>\r\n                        </select>\r\n                        <input type=\"text\" value={pregunta} onChange={e => setPregunta(e.target.value)} placeholder=\"Pregunta\" className=\"border p-2 rounded\" />\r\n                        <input type=\"text\" value={respuesta} onChange={e => setRespuesta(e.target.value)} placeholder=\"Respuesta\" className=\"border p-2 rounded\" />\r\n                        <button type=\"submit\" className=\"bg-purple-500 text-white px-4 py-2 rounded\">Agregar pregunta</button>\r\n                    </form>\r\n\r\n                    {/* Panel de administraci칩n y antibullying */}\r\n                    <div className=\"bg-white shadow rounded p-6 mb-8 flex flex-col gap-4\">\r\n                        <h3 className=\"text-lg font-bold mb-2\">Panel de administraci칩n y antibullying</h3>\r\n                        <form onSubmit={handlePalabraProhibidaSubmit} className=\"flex gap-2 mb-2\">\r\n                            <input type=\"text\" value={palabraProhibida} onChange={e => setPalabraProhibida(e.target.value)} placeholder=\"Palabra prohibida\" className=\"border p-2 rounded\" />\r\n                            <button type=\"submit\" className=\"bg-red-500 text-white px-4 py-2 rounded\">Agregar palabra</button>\r\n                        </form>\r\n                        <button type=\"button\" onClick={handleApagarBullying} className=\"bg-gray-500 text-white px-4 py-2 rounded\">Desactivar antibullying</button>\r\n                        {bullyingActivo && (\r\n                            <div className=\"text-red-600 font-bold\">Antibullying activo para: {usuarioBullying}</div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default PerfilUsuario;\r\n","// Archivo para importar y transformar trofeos premium desde el JSON\r\nimport trofeosPremium from './trofeos-premium.json';\r\n\r\nexport const TROFEOS_PREMIUM = trofeosPremium.map(t => ({\r\n    src: t.imagen,\r\n    texto: `${t.titulo}\\n${t.descripcion}`,\r\n    tipo: 'manual'\r\n}));\r\n"],"names":[],"mappings":"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"}