module.exports=[31894,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(68384),e=a.i(55223);let f=({userGrade:d,onTournamentComplete:f})=>{let g,{preguntaActual:h,setPreguntaActual:i,objetoPreguntaActual:j,setObjetoPreguntaActual:k,respuestaCorrecta:l,setRespuestaCorrecta:m,respuestaUsuario:n,setRespuestaUsuario:o,feedback:p,setFeedback:q,preguntasUsadas:r,setPreguntasUsadas:s,timeLeft:t,setTimeLeft:u,bloqueado:v,setBloqueado:w,aciertos:x,setAciertos:y,puntuacionTotal:z,setPuntuacionTotal:A,preguntaNumero:B,setPreguntaNumero:C,comprobarRespuesta:D,generarPregunta:E,resetQuiz:F}=(0,e.useQuizLogic)({timeLimit:300,onTimeUp:()=>{A(z-15),q("â° Tiempo agotado. -15 puntos")}}),G=[];try{G=a.f({"../questions/general-1primaria.json":{id:()=>83772,module:()=>a.r(83772)},"../questions/general-2primaria.json":{id:()=>13725,module:()=>a.r(13725)},"../questions/general-3primaria.json":{id:()=>98958,module:()=>a.r(98958)},"../questions/general-4primaria.json":{id:()=>83846,module:()=>a.r(83846)},"../questions/general-5primaria.json":{id:()=>60450,module:()=>a.r(60450)},"../questions/general-6primaria.json":{id:()=>31390,module:()=>a.r(31390)}})(`../questions/general-${d}primaria.json`)}catch{G=[]}let H=()=>{r.length>=25?f(x,z):E(G,25,()=>{f(x,z)})},I=()=>{if(v)return;let a=300-t,b=0;n.toLowerCase().trim()===l.toLowerCase().trim()?(y(x+1),a<=60?(b=10,q("âœ… Â¡Correcto! +10 puntos (rÃ¡pido)")):(b=5,q("âœ… Â¡Correcto! +5 puntos"))):a<=60?(b=-5,q(`âŒ Incorrecto. -5 puntos
La respuesta correcta era: ${l}`)):(b=-10,q(`âŒ Incorrecto. -10 puntos
La respuesta correcta era: ${l}`)),A(z+b),w(!0)};return(c.default.useEffect(()=>{G.length>0&&!h&&H()},[G]),r.length>=25)?(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 flex items-center justify-center p-8",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8 text-center max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"ðŸŽ¯ Â¡Torneo Completado!"}),(0,b.jsx)("div",{className:"text-6xl mb-4",children:"ðŸ†"}),(0,b.jsxs)("p",{className:"text-lg mb-2",children:["Aciertos: ",(0,b.jsxs)("strong",{children:[x,"/25"]})]}),(0,b.jsxs)("p",{className:"text-lg mb-2",children:["PuntuaciÃ³n total: ",(0,b.jsxs)("strong",{children:[z," puntos"]})]}),(0,b.jsxs)("p",{className:"text-lg",children:["Promedio: ",(0,b.jsxs)("strong",{children:[(z/25).toFixed(1)," pts/pregunta"]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-4",children:"Los resultados se procesarÃ¡n automÃ¡ticamente..."})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-700 p-8",children:(0,b.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,b.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-6 text-center",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"ðŸŽ¯ Modo Torneo Premium"}),(0,b.jsxs)("div",{className:"flex justify-center gap-6 text-white",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[B,"/25"]}),(0,b.jsx)("div",{className:"text-sm",children:"Pregunta"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:x}),(0,b.jsx)("div",{className:"text-sm",children:"Aciertos"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:(g=Math.floor(t/60),`${g}:${(t%60).toString().padStart(2,"0")}`)}),(0,b.jsx)("div",{className:"text-sm",children:"Tiempo"})]})]})]}),(0,b.jsx)("div",{className:"bg-white rounded-lg shadow-xl p-8",children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:h}),j&&j.imagen&&(0,b.jsx)("div",{className:"mb-4 flex justify-center",children:(0,b.jsx)("img",{src:j.imagen,alt:"Pregunta",className:"max-w-full h-auto max-h-64 rounded-lg"})})]}),(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)("input",{type:"text",value:n,onChange:a=>o(a.target.value),onKeyPress:a=>"Enter"===a.key&&I(),placeholder:"Escribe tu respuesta aquÃ­...",className:"w-full p-4 border border-gray-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-purple-500",disabled:v})}),(0,b.jsx)("div",{className:"flex gap-4",children:v?(0,b.jsx)("button",{onClick:()=>H(),className:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition-colors",children:r.length>=25?"Finalizar Torneo":"Siguiente Pregunta"}):(0,b.jsx)("button",{onClick:I,disabled:!n.trim(),className:"flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700 disabled:bg-gray-400 transition-colors",children:"Verificar Respuesta"})}),p&&(0,b.jsx)("div",{className:`mt-4 p-4 rounded-lg text-center font-semibold ${p.includes("âœ…")?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p})]}):(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"text-6xl mb-4",children:"ðŸŽ¯"}),(0,b.jsx)("p",{className:"text-xl",children:"Cargando torneo..."})]})})]})})};var g=a.i(59722);async function h(a){try{let b=await fetch("/api/users");if(!b.ok)return{};let c=(await b.json()).filter(a=>"Docente"===a.tipo),d={};for(let b of c)try{let c=await fetch(`/api/stats/championship?nick=${b.nick}&temporada=t${a}&tipo=docentes`);if(c.ok){let a=await c.json();a.likes&&(d[b.nick]=a.likes)}}catch(a){console.error(`Error obteniendo stats para ${b.nick}:`,a)}let e=Object.entries(d).sort((a,b)=>b[1]-a[1]).slice(0,25);return Object.fromEntries(e)}catch(a){return console.error("Error obteniendo tabla docentes:",a),{}}}function i(){let a,e,[i,j]=c.default.useState((e=(a=new Date).getFullYear(),a.getMonth()+1<10?e-1:e)),[k,l]=c.default.useState({}),[m,n]=c.default.useState(!1),[o,p]=c.default.useState(!1),[q,r]=c.default.useState(!1),[s,t]=c.default.useState(!1),[u,v]=c.default.useState(!1),[w,x]=c.default.useState(null),[y,z]=c.default.useState(1),[A,B]=c.default.useState(""),C=["Naturaleza","MatemÃ¡ticas","Lenguaje","Literatura","InglÃ©s","GeografÃ­a","Historia","General","Campeonato"];async function D(a,b){try{await fetch("/api/user/update-likes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({likesDelta:b})})}catch(a){console.error("Error actualizando likes del perfil:",a)}}c.default.useEffect(()=>{(async()=>{l(await h(i))})()},[i]);let[E,F]=c.default.useState(null),[G,H]=c.default.useState("1Âº Primaria"),[I,J]=c.default.useState("matematicas"),[K,L]=c.default.useState(""),[M,N]=c.default.useState(null),[O,P]=c.default.useState(""),[Q,R]=c.default.useState(""),[S,T]=c.default.useState(""),[U,V]=c.default.useState(300),[W,X]=c.default.useState(!1);c.default.useEffect(()=>{},[]),c.default.useEffect(()=>{if(!K||W)return;if(0===U){X(!0),T("â° Tiempo agotado. No puedes responder esta pregunta. -2 likes"),E&&D(E.nick,-2).catch(a=>console.error("Error penalizando likes:",a));return}let a=setTimeout(()=>V(U-1),1e3);return()=>clearTimeout(a)},[U,K,W]);let[Y,Z]=c.default.useState([]);c.default.useEffect(()=>{(async()=>{let a=1;if(G){let b=G.match(/(\d+)/);b&&(a=Number(b[1]))}let b=[];for(let c of["matematicas","lenguaje","literatura","historia","geografia","naturaleza","ingles","general","campeonato"])try{let d=await fetch(`/api/questions?curso=${a}primaria&asignatura=${c}`);if(d.ok){let a=await d.json();b=b.concat(a)}}catch{}Z(b)})()},[G]);let $=c.default.useMemo(()=>"General"===I?Y:Y.filter(a=>a.categoria.toLowerCase().replace(/Ã¡/g,"a").replace(/Ã©/g,"e").replace(/Ã­/g,"i").replace(/Ã³/g,"o").replace(/Ãº/g,"u")===I),[Y,I]),[_,aa]=c.default.useState([]);async function ab(){if(W)return;let a=E?.esProfesor||E?.tipo==="docente"||E?.tipo==="Docente",b=a?.5:1;function c(a){return a.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").replace(/\s+/g,"").trim()}let d=c(Q)===c(O);if(X(!0),d){if(U>120){let c=+b;T(`\xa1Correcto! ðŸŽ‰ +${c} like${1!==c?"s":""}${a?" (Docente: 50% puntos)":""}`)}else T(`\xa1Correcto! ðŸŽ‰ +${.5*b} likes${a?" (Docente: 50% puntos)":""}`);E&&(fetch("/api/user/increment-stat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stat:"respuestasAcertadas",amount:1})}).catch(a=>console.error("Error updating DB stats:",a)),M&&M.categoria)}else{if(U>120)T(`Incorrecto. La respuesta era: ${O} ${-.5*b} likes${a?" (Docente: 50% puntos)":""}`);else{let c=-1*b;T(`Incorrecto. La respuesta era: ${O} ${c} like${1!==Math.abs(c)?"s":""}${a?" (Docente: 50% puntos)":""}`)}E&&fetch("/api/user/increment-stat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stat:"preguntasFalladas",amount:1})}).catch(a=>console.error("Error updating DB stats falladas:",a))}window.dispatchEvent(new Event("profileUpdate"))}return q?(0,b.jsx)(f,{userGrade:parseInt(G)||1,onTournamentComplete:()=>{}}):(0,b.jsxs)("div",{className:"min-h-screen bg-green-100 p-8 flex flex-col items-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Aprende con Pipo"}),(0,b.jsxs)("div",{className:"flex items-stretch mx-auto",style:{transform:"translateX(-80px)"},children:[(0,b.jsx)("img",{src:"/trofeo16.jpg",alt:"Trofeo 16",className:"h-40 object-contain mr-4"}),(0,b.jsx)("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-md p-8 flex flex-col gap-6 mx-auto",children:m?(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)(d.default,{userGrade:y,userSchool:A}),(0,b.jsx)("button",{className:g.BUTTON_STYLES.secondary+" mt-4",onClick:()=>n(!1),children:"Salir de competiciÃ³n"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg border-2 border-blue-200 mb-4",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-blue-800 mb-2",children:"ðŸ›¡ï¸ Sistema Anti-Trampa Activo"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-semibold text-blue-700",children:"ðŸ‘¤ Usuario:"}),(0,b.jsx)("span",{className:"ml-2 text-gray-800",children:E?.nick||"No detectado"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-semibold text-blue-700",children:"ðŸŽ“ Curso detectado:"}),(0,b.jsx)("span",{className:"ml-2 text-gray-800 font-semibold",children:G})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-semibold text-blue-700",children:"ðŸ« Centro:"}),(0,b.jsx)("span",{className:"ml-2 text-gray-800",children:E?.centro||"No asignado"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-semibold text-blue-700",children:"ðŸ‘¥ Tipo:"}),(0,b.jsx)("span",{className:"ml-2 text-gray-800",children:E?.esProfesor||E?.tipo==="docente"||E?.tipo==="Docente"?"Docente":"Estudiante"})]})]}),(0,b.jsxs)("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:[(0,b.jsxs)("p",{className:"text-xs text-yellow-800",children:["ðŸ”’ ",(0,b.jsx)("strong",{children:"Solo podrÃ¡s responder preguntas de tu nivel"})," para garantizar puntuaciones justas."]}),(E?.esProfesor||E?.tipo==="docente"||E?.tipo==="Docente")&&(0,b.jsxs)("p",{className:"text-xs text-orange-800 mt-2",children:["ðŸ‘©â€ðŸ« ",(0,b.jsx)("strong",{children:"Modo Docente:"})," Preguntas de 6Âº curso y puntuaciÃ³n reducida al 50% para equilibrar la dificultad."]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-center",children:[(0,b.jsx)("label",{className:"font-semibold",children:"Asignatura:"}),(0,b.jsx)("select",{className:"border rounded px-2 py-1",value:I,onChange:a=>J(a.target.value),children:["naturaleza","matematicas","lenguaje","literatura","ingles","geografia","historia","general","campeonato"].map((a,c)=>(0,b.jsx)("option",{value:a,children:C[c]},a))}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:["(Curso fijo: ",(0,b.jsx)("strong",{children:G}),")"]})]}),(0,b.jsx)("button",{className:g.BUTTON_STYLES.primary+" mt-4",onClick:function(){if(0===$.length){L(""),N(null),P(""),T("No hay preguntas para esta asignatura."),X(!1),V(300),aa([]);return}let a=$.filter(a=>!_.includes(a.pregunta));if(0===a.length){L(""),N(null),P(""),T("Â¡Has respondido todas las preguntas disponibles!"),X(!0),V(300),aa([]);return}let b=Math.floor(Math.random()*a.length),c=a[b];L(c.pregunta),N(c),P(c.respuesta),R(""),T(""),X(!1),V(300),aa([..._,c.pregunta])},children:"Generar pregunta"}),(0,b.jsx)("button",{className:g.BUTTON_STYLES.orange+" mt-4 self-center",onClick:()=>{let a=1,b="";if(E){let c=1;if(E.curso)if("string"==typeof E.curso){let a=E.curso.match(/(\d)/);a&&(c=Number(a[1]))}else"number"==typeof E.curso&&(c=E.curso);!isNaN(c)&&c>=1&&c<=6&&(a=c),E.centro&&(b=E.centro)}n(!0),z(a),B(b)},children:"Modo competiciÃ³n"}),s&&(0,b.jsx)("button",{className:g.BUTTON_STYLES.purple+" mt-4 self-center",onClick:()=>{r(!0)},children:"Modo torneo"}),K&&(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("div",{className:"font-semibold mb-2",children:K}),(0,b.jsxs)("div",{className:"font-bold text-lg mb-2",children:["â° Tiempo: ",Math.floor(U/60),":",(U%60).toString().padStart(2,"0")," min"]}),(0,b.jsx)("input",{type:"text",className:"border rounded px-2 py-1 w-full mb-2",value:Q,onChange:a=>R(a.target.value),placeholder:"Escribe tu respuesta aquÃ­",disabled:W}),(0,b.jsx)("button",{className:g.BUTTON_STYLES.success,onClick:ab,disabled:W,children:"Comprobar respuesta"}),S&&(0,b.jsx)("div",{className:"mt-2 font-bold",children:S})]}),S&&!K&&(0,b.jsx)("div",{className:"mt-2 font-bold text-red-600",children:S}),(0,b.jsxs)("div",{className:"mt-8",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Ranking Docentes"}),(0,b.jsxs)("table",{className:"w-full border mb-4",style:{backgroundColor:"#fffbe6"},children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{style:{backgroundColor:"#fff9c4"},children:[(0,b.jsx)("th",{className:"p-2",children:"Docente"}),(0,b.jsx)("th",{className:"p-2",children:"Likes"})]})}),(0,b.jsx)("tbody",{children:Object.entries(k).map(([a,c])=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"border p-2",children:a}),(0,b.jsx)("td",{className:"border p-2",children:c})]},a))})]})]})]})}),(0,b.jsx)("img",{src:"/logo-pipo.jpg",alt:"Logo Pipo",className:"h-40 object-contain ml-4"})]})]})}a.s(["default",()=>i],31894)}];

//# sourceMappingURL=src_app_aprende-con-pipo_page_tsx_e827a85e._.js.map