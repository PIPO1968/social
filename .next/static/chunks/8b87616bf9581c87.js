(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78841,e=>{"use strict";var t=e.i(43476),a=e.i(71645);function l(){let[e,l]=(0,a.useState)(""),[s,i]=(0,a.useState)(""),[r,n]=(0,a.useState)(""),[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[x,b]=(0,a.useState)(""),[m,g]=(0,a.useState)(!1),[f,j]=(0,a.useState)([]),v=(0,a.useRef)(null),y=e=>{let t=v.current;if(!t)return;let a=t.selectionStart,l=t.selectionEnd,r=s;"bold"===e?r=s.slice(0,a)+"<b>"+s.slice(a,l)+"</b>"+s.slice(l):"underline"===e&&(r=s.slice(0,a)+"<u>"+s.slice(a,l)+"</u>"+s.slice(l)),i(r)},N=async()=>{try{let t=await fetch("/api/auth/me"),a=await t.json();if(!a.user&&!d)return void alert("No se puede enviar la historia: no se ha detectado usuario. Inicia sesi贸n como docente o alumno.");let r=a.user?a.user.nick:null,n=await fetch("/api/palabras-prohibidas"),u=(await n.json()).palabras||[],p=s.toLowerCase(),b=u.filter(e=>p.includes(e)||p.includes(e+"a")||p.includes(e+"o"));b.length>0&&(j(b),g(!0),setTimeout(()=>g(!1),3e4)),await fetch("/api/historias",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({titulo:e,contenido:s,autorNick:d?"An贸nimo":r,imagen:o,concurso:h?x:null})}),alert("Historia enviada!"),l(""),i(""),c(null)}catch(e){console.error("Error creando historia:",e),alert("Error enviando historia")}};return(0,t.jsxs)("div",{className:"min-h-screen bg-green-100 p-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Crea tu Historia"}),(0,t.jsxs)("div",{className:"flex w-full justify-center items-start gap-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 w-64 flex flex-col gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Modo de historia:"}),(0,t.jsxs)("select",{className:"w-full border rounded px-2 py-1",children:[(0,t.jsx)("option",{children:"Real"}),(0,t.jsx)("option",{children:"Ficticia"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold mb-2",children:"Tipo de historia:"}),(0,t.jsxs)("select",{className:"w-full border rounded px-2 py-1",children:[(0,t.jsx)("option",{children:"Aventura"}),(0,t.jsx)("option",{children:"Coraz贸n"}),(0,t.jsx)("option",{children:"Terror"}),(0,t.jsx)("option",{children:"Ficci贸n"}),(0,t.jsx)("option",{children:"Educativa"}),(0,t.jsx)("option",{children:"My Live"}),(0,t.jsx)("option",{children:"Concurso"})]})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("label",{className:"inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",className:"form-checkbox mr-2",checked:d,onChange:e=>u(e.target.checked)}),"Escribir en modo An贸nimo"]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"inline-flex items-center mt-2",children:[(0,t.jsx)("input",{type:"checkbox",className:"form-checkbox mr-2",checked:h,onChange:e=>p(e.target.checked)}),"Escribir en modo Concurso"]}),h&&(0,t.jsx)("input",{type:"text",placeholder:"N煤mero de concurso",className:"w-full border rounded px-2 py-1 mt-2",value:x,onChange:e=>b(e.target.value.replace(/[^0-9]/g,""))})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 flex-1 flex flex-col gap-6",children:[(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("input",{type:"text",placeholder:"T铆tulo de la historia",className:"w-full border rounded px-3 py-2 font-semibold text-lg mb-2",value:e,onChange:e=>l(e.target.value)}),h&&(0,t.jsx)("input",{type:"text",placeholder:"N潞 concurso",className:"border rounded px-2 py-1 w-24 text-center",value:x,onChange:e=>b(e.target.value.replace(/[^0-9]/g,""))})]}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)("button",{type:"button",className:"bg-gray-200 px-2 py-1 rounded font-bold",title:"Negrita",onClick:()=>y("bold"),children:"B"}),(0,t.jsx)("button",{type:"button",className:"bg-gray-200 px-2 py-1 rounded font-bold",title:"Subrayado",onClick:()=>y("underline"),children:"S"}),(0,t.jsxs)("label",{className:"bg-gray-200 px-2 py-1 rounded cursor-pointer font-bold",title:"Subir imagen",children:["",(0,t.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=()=>{c(e.result)},e.readAsDataURL(t)}}})]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsx)("div",{className:"w-full mb-2",children:(0,t.jsx)("textarea",{ref:v,placeholder:"Escribe tu historia aqu铆...",className:"w-full border rounded px-3 py-2 min-h-[120px] mb-2",value:s,onChange:e=>i(e.target.value),style:o?{resize:"vertical",backgroundImage:`url(${o})`,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",opacity:.95}:{resize:"vertical"}})})}),(0,t.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded self-end",onClick:N,children:"Enviar"})]})]}),m&&f.length>0&&(0,t.jsxs)("div",{className:"fixed top-8 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-6 py-4 rounded shadow-lg z-50 text-lg font-bold",children:["Palabra prohibida -10 likes de penalizaci贸n",(0,t.jsx)("br",{}),"Detectadas: ",f.join(", ")]})]})}e.s(["default",()=>l])}]);